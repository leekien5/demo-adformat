(function(d){d.isScrollToFixed=function(f){return!!d(f).data("ScrollToFixed")};d.ScrollToFixed=function(f,G){function A(){var c=b.options.limit;return c?"function"===typeof c?c.apply(a):c:0}function p(){return"fixed"===h}function l(){return!(p()||"absolute"===h)}function w(){if(!p()){var c=a[0].getBoundingClientRect();e.css({display:a.css("display"),width:c.width,height:c.height,"float":a.css("float")});cssOptions={"z-index":b.options.zIndex,position:"fixed",top:-1==b.options.bottom?r():"",bottom:-1==b.options.bottom?"":b.options.bottom,"margin-left":"0px"};b.options.dontSetWidth||(cssOptions.width=a.css("width"));a.css(cssOptions);a.addClass(b.options.baseClassName);b.options.className&&a.addClass(b.options.className);h="fixed"}}function B(){var c=A(),d=n;b.options.removeOffsets&&(d="",c-=t);cssOptions={position:"absolute",top:c,left:d,"margin-left":"0px",bottom:""};b.options.dontSetWidth||(cssOptions.width=a.css("width"));a.css(cssOptions);h="absolute"}function k(){l()||(q=-1,e.css("display","none"),a.css({"z-index":C,width:"",position:x,left:"",top:D,"margin-left":""}),a.removeClass("scroll-to-fixed-fixed"),b.options.className&&a.removeClass(b.options.className),h=null)}function y(b){b!=q&&(a.css("left",n-b),q=b)}function r(){var c=b.options.marginTop;return c?"function"===typeof c?c.apply(a):c:0}function g(){if(d.isScrollToFixed(a)&&!a.is(":hidden")){var c=u,e=l();u?l()&&(t=a.offset().top,n=a.offset().left):(a.trigger("preUnfixed.ScrollToFixed"),k(),a.trigger("unfixed.ScrollToFixed"),q=-1,t=a.offset().top,n=a.offset().left,b.options.offsets&&(n+=a.offset().left-a.position().left),-1==E&&(E=n),h=a.css("position"),u=!0,-1!=b.options.bottom&&(a.trigger("preFixed.ScrollToFixed"),w(),a.trigger("fixed.ScrollToFixed")));var f=d(window).scrollLeft(),g=d(window).scrollTop(),v=A();b.options.minWidth&&d(window).width()<b.options.minWidth?l()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),k(),a.trigger("unfixed.ScrollToFixed")):b.options.maxWidth&&d(window).width()>b.options.maxWidth?l()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),k(),a.trigger("unfixed.ScrollToFixed")):-1==b.options.bottom?0<v&&g>=v-r()?e||"absolute"===h&&c||(m(),a.trigger("preAbsolute.ScrollToFixed"),B(),a.trigger("unfixed.ScrollToFixed")):g>=t-r()?(p()&&c||(m(),a.trigger("preFixed.ScrollToFixed"),w(),q=-1,a.trigger("fixed.ScrollToFixed")),y(f)):l()&&c||(m(),a.trigger("preUnfixed.ScrollToFixed"),k(),a.trigger("unfixed.ScrollToFixed")):0<v?(c=g+d(window).height()-a.outerHeight(!0),(e=r())||(e=b.options.bottom?b.options.bottom:0,e=-e),c>=v-e?p()&&(m(),a.trigger("preUnfixed.ScrollToFixed"),"absolute"===x?B():k(),a.trigger("unfixed.ScrollToFixed")):(p()||(m(),a.trigger("preFixed.ScrollToFixed"),w()),y(f),a.trigger("fixed.ScrollToFixed"))):y(f)}}function m(){var b=a.css("position");"absolute"==b?a.trigger("postAbsolute.ScrollToFixed"):"fixed"==b?a.trigger("postFixed.ScrollToFixed"):a.trigger("postUnfixed.ScrollToFixed")}var b=this;b.$el=d(f);b.el=f;b.$el.data("ScrollToFixed",b);var u=!1,a=b.$el,h,x,D,C,t=0,n=0,E=-1,q=-1,e=null,z=function(b){a.is(":visible")?(u=!1,g()):k()},F=function(a){window.requestAnimationFrame?requestAnimationFrame(g):g()};b.init=function(){b.options=d.extend({},d.ScrollToFixed.defaultOptions,G);C=a.css("z-index");b.$el.css("z-index",b.options.zIndex);e=d("<div />");h=a.css("position");x=a.css("position");a.css("float");D=a.css("top");l()&&b.$el.after(e);d(window).bind("resize.ScrollToFixed",z);d(window).bind("scroll.ScrollToFixed",F);"ontouchmove"in window&&d(window).bind("touchmove.ScrollToFixed",g);b.options.preFixed&&a.bind("preFixed.ScrollToFixed",b.options.preFixed);b.options.postFixed&&a.bind("postFixed.ScrollToFixed",b.options.postFixed);b.options.preUnfixed&&a.bind("preUnfixed.ScrollToFixed",b.options.preUnfixed);b.options.postUnfixed&&a.bind("postUnfixed.ScrollToFixed",b.options.postUnfixed);b.options.preAbsolute&&a.bind("preAbsolute.ScrollToFixed",b.options.preAbsolute);b.options.postAbsolute&&a.bind("postAbsolute.ScrollToFixed",b.options.postAbsolute);b.options.fixed&&a.bind("fixed.ScrollToFixed",b.options.fixed);b.options.unfixed&&a.bind("unfixed.ScrollToFixed",b.options.unfixed);b.options.spacerClass&&e.addClass(b.options.spacerClass);a.bind("resize.ScrollToFixed",function(){e.height(a.height())});a.bind("scroll.ScrollToFixed",function(){a.trigger("preUnfixed.ScrollToFixed");k();a.trigger("unfixed.ScrollToFixed");g()});a.bind("detach.ScrollToFixed",function(c){c=c||window.event;c.preventDefault&&c.preventDefault();c.returnValue=!1;a.trigger("preUnfixed.ScrollToFixed");k();a.trigger("unfixed.ScrollToFixed");d(window).unbind("resize.ScrollToFixed",z);d(window).unbind("scroll.ScrollToFixed",F);a.unbind(".ScrollToFixed");e.remove();b.$el.removeData("ScrollToFixed")});z()};b.init()};d.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1E3,baseClassName:"scroll-to-fixed-fixed"};d.fn.scrollToFixed=function(f){return this.each(function(){new d.ScrollToFixed(this,f)})}})(jQuery);