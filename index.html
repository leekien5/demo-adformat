<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>YOMEDIA | Ad Format Demo</title>
        <link rel="icon" href="favicon.ico" type="image/gif" sizes="16x16" />
        <link rel="stylesheet" href="resource/css/bootstrap.min.css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css" />
        <link href="resource/css/style.css" rel="stylesheet" type="text/css" />
        <link href="resource/css/chosen.min.css" rel="stylesheet" type="text/css" />
        <link href="resource/css/compiled.min.css" rel="stylesheet" type="text/css" />
        <link href="resource/css/jquery.toast.css" rel="stylesheet" type="text/css" />
    </head>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand"></a>
            <a href="https://yomedia.vn" target="_blank">
                <img class="logo-yomedia" src="./resource/images/logo-yomedia.png" alt="" />
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Adformats
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://yomedia.vn/case-studies/" target="_blank">Case Studies</a>
                            <a class="dropdown-item" href="https://yomedia.vn/demos/" target="_blank">Showcases</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-xl-8 offset-xl-2 pt-5 pb-2">
                    <h1>Ad Formats Demo Form</h1>
                    <p class="lead">Fill in required fields to generate an ad format demo link.</p>
                    <form id="frmCreateSource" name="create_source" method="get" action="#" role="form">
                        <div class="messages"></div>
                        <div class="controls">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group" id="type">
                                        <label for="optTypes">Ad View</label>
                                        <select id="optTypes" name="optTypes" class="chosen-select form-control">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group" id="template">
                                        <label for="optTemplates">Template</label>
                                        <select class="chosen-select form-control" id="optTemplates">
                                            <option value="">None</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="optAdformats">Ad Format</label>
                                        <select id="optAdformats" name="optAdformats" class="form-control">
                                            <option value="">None</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" id="mainSource">
                                    <div class="form-group">
                                        <label for="basic-url">Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                                                        <path d="M4.715 6.542L3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.001 1.001 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
                                                        <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 0 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 0 0-4.243-4.243L6.586 4.672z"/>
                                                      </svg>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="txtSource" placeholder="Source here ..." rows="2" data-error="Banner link is required."></input>
                                        </div>
                                    </div>
                                    <div class="form-group" id="secondSource">
                                        <label for="basic-url">Addition Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                                                        <path d="M4.715 6.542L3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.001 1.001 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
                                                        <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 0 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 0 0-4.243-4.243L6.586 4.672z"/>
                                                      </svg>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="txtSource2" placeholder="Source here ..." rows="2" data-error="Banner link is required."></input>
                                        </div>
                                    </div>
                                    <div class="form-group" id="videoSource">
                                        <label for="basic-url">Video Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
                                                        <path d="M4.715 6.542L3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.001 1.001 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
                                                        <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 0 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 0 0-4.243-4.243L6.586 4.672z"/>
                                                      </svg>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="txtSourceVideo" placeholder="Source here ..." rows="2" data-error="Banner link is required."></input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="docs-pills border">
                                <div class="d-flex justify-content-between py-2" style="padding-left: .6rem;">
                                    <ul class="nav nav-pills">
                                        <li class="nav-item"><label class="nav-link active show">Output Source</label></li>
                                    </ul>
                                </div>
                                <div class="tab-content" id="output">
                                    <div class="tab-pane fade active show" id="" role="tabpanel">
                                        <div class="code-toolbar">
                                            <div class="toolbar">
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-dark btn-sm" id="btnCopy" data-clipboard-target="#txtOutput" style="right: 165px;">Copy</button>
                                                </div>
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-dark btn-sm" id="btnOpen">Open in Browser</button>
                                                </div>
                                            </div>
                                            <textarea class="form-control" style="border-style: none" id="txtOutput" readonly></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hidden"><input type="submit"></div>
                    </form>
                </div>
                    <div class="col-xl-8 offset-xl-2 pt-3">
                        <button type="button" id="btnSave" onclick="$('#frmCreateSource').submit();" class="btn btn-success btn-send">Submit</button>
                        <button type="button" id="btnReset" class="ml-2 btn btn-warning btn-send">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="resource/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="resource/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="resource/js/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>
    <script type="text/javascript" src="resource/js/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="resource/js/jquery.toast.js"></script>
    <script type="text/javascript" src="scripts/database.js"></script>
    <script type="text/javascript">
    $("#secondSource").hide();
    $("#videoSource").hide();
    $('#frmCreateSource').validate();

    $(function () {
        //Buttons area
        $('#btnOpen').on('click', function () {
            event.preventDefault(); 
            openFunction();
        });
        $('#btnReset').on('click', function () {
            event.preventDefault(); 
            resetForm();
        });
        $('#btnCopy').on('click', function() {
            event.preventDefault(); 
            if( $('#txtOutput').val().length === 0 ) {
                //Notification: error
                $.toast({
                    heading: 'Warning',
                    text: 'There is nothing to copy, please try again!',
                    position: 'top-right',
                    showHideTransition: 'fade',
                    icon: 'warning'
                })
            } else {
                //get a reference to the JQUERY object of the current button
                let theButton = $(this);
                var clipboard = new ClipboardJS('#btnCopy');

                clipboard.on('success', function(e) {
                    //use the .text method of the Jquery object
                    theButton.text('Copied');
                    setTimeout(function() {
                    //same again
                    theButton.text('Copy');
                    }, 2000);
                });
            }
        });

        function sortArray() {
            var options = $(".option");
            options.sort(function(a,b) {
                if (a.text > b.text) return 1;
                else if (a.text < b.text) return -1;
                else return 0
            });
        }
        //Show Device select option
        $.each(list.devices, function (idx, obj) {
            $("#optTypes").append('<option type="' + obj.type + '" value="' + obj.value + '">' + obj.name + '</option>');
        });

        $("#optTemplates, #optAdformats").trigger("list:updated");
        $("#optTemplates, #optAdformats").chosen();

        $("#optTemplates, #optAdformats, #optTypes").chosen({search_contains: true});
        $("#optTemplates, #optAdformats, #optTypes").chosen({max_selected_options:10, search_contains: true});

        //Type Device on change
        $("#optTypes").change(function(){
            var type = $(this).find(":selected").val();
            var templates = list.templates.filter(function(template) {
                return template.type === type;
            });
            var adformats = list.adformats.filter(function(adformat) {
                return adformat.type === type;
            });
            $('#optTemplates').empty();
            $.each(templates, function (idx, obj) {
                $('#optTemplates').append(`<option type="${obj.type}" value="${obj.value}">${obj.name}</option>`)            
            });
            $('#optAdformats').empty();
            $.each(adformats, function (idx, obj) {
                $('#optAdformats').append(`<option type="${obj.type}" value="${obj.value}">${obj.name}</option>`)            
            });
            $('#optTemplates').trigger('chosen:updated');
            $('#optAdformats').trigger('chosen:updated');
        });

        //Ad Format on change
        $("#optAdformats").change(function() {
        selectedType = $(this).val();
            switch (selectedType) {
                case 'billboard': case 'balloon': case '3d-post-carousel': 
                case 'masthead-mb': case 'inpage': case 'firstview': 
                case 'footer': case 'on-image-mb': case 'iab-medium-rectangle': 
                case 'iab-half-page':
                    $("#mainSource").show();
                    $("#secondSource").hide();
                    $("#videoSource").hide();
                    break;
                
                case 'in-native': case 'in-takeover': case 'in-carousel': case 'on-image-pc':
                    $("#mainSource").show();
                    $("#secondSource").show();
                    $("#videoSource").hide();
                    $("#txtSourceVideo").val('');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                    break;

                case 'in-inread':
                    $("#mainSource").show();
                    $("#videoSource").show();
                    $("#secondSource").hide();
                    $("#txtSource2").val('');
                    break;
            }
        });
    });

    //Reset Form
    function resetForm() {
        //Notification: success
        $.toast({
                heading: 'Success',
                text: 'Reset successful!',
                position: 'top-right',
                showHideTransition: 'slide',
                icon: 'success'
        });

        $('#frmCreateSource').trigger("reset");
        $('#optTypes, #optTemplates, #optAdformats').prop('selectedIndex',0);
        $('#optTemplates, #optAdformats').empty();
        $('#optTemplates, #optAdformats, #optTypes').val('').trigger('chosen:updated');
        $('.chosen').trigger('chosen:updated');
        $("#secondSource").hide();
        $("#videoSource").hide();
        $('#txtOutput').empty();
    };

    //Open function for btnOpen
    function openFunction() {
        if( $('#txtOutput').val().length === 0 ) {
            //Notification: error
            $.toast({
                heading: 'Warning',
                text: 'There is nothing to open, please try again!',
                position: 'top-right',
                showHideTransition: 'fade',
                icon: 'warning'
            })
        } else {
            var textURL = document.getElementById("txtOutput");
            textURL.select();
            window.open(textURL.value);
        }
    };

    //Is valid URL
    function isValidURL(str) {
        var regex = /(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;
        if(!regex .test(str)) {
            return false;
        } else {
            return true;
        }
    };

    //Submit
    $('#frmCreateSource').submit(function(e) {
        e.preventDefault();
        let adformatURL = '' ; 
        var template = $("#optTemplates").val();
        var format = $("#optAdformats").val();
        var sourceURL = $("#txtSource").val();
        var additionSourceURL = $("#txtSource2").val();
        var videoSourceURL = $("#txtSourceVideo").val();
        var url = window.location.href;
        var p = url.search("index.");
        var prefix = "https://demo.yomedia.vn/"

        if (p != -1) {
            url = url.substring(0, p);
        }
        if(!template || !format) {
                //Notification: error
                $.toast({
                heading: 'Error',
                text: 'Please choose an Ad View, Template or Ad Format before submitting!',
                position: 'top-right',
                showHideTransition: 'fade',
                icon: 'error'
            });
            return;
        }
        if(isValidURL(sourceURL || additionSourceURL || videoSourceURL)) {
            adformatURL = url + 'sites/'  + template + '/index.html' + `?f=${format}&b=` + `${sourceURL}`;
            additionSourceURL ? adformatURL = adformatURL + '&c=' + `${additionSourceURL}` : adformatURL;
            videoSourceURL ? adformatURL = adformatURL + '&c=' + `${videoSourceURL}` : adformatURL;
        } else {
            adformatURL = url + 'sites/'  + template + '/index.html' + `?f=${format}&b=` + prefix + `${sourceURL}`;
            additionSourceURL ? adformatURL = adformatURL + '&c=' + prefix + `${additionSourceURL}` : adformatURL;
            videoSourceURL ? adformatURL = adformatURL + '&c=' + prefix + `${videoSourceURL}` : adformatURL;
        }
        $("#txtOutput").empty();
        $("#txtOutput").append(adformatURL);
        
        //Notification: success
        $.toast({
            heading: 'Success',
            text: 'Ad format demo link generated!',
            position: 'top-right',
            showHideTransition: 'slide',
            icon: 'success'
        })
    });
    </script>
</html>
