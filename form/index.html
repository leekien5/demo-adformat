<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>YOMEDIA | Ad Format Demo</title>
        <link rel="icon" href="../resources/images/favicon.ico" type="image/gif" sizes="16x16" />
        <link rel="stylesheet" href="resources/css/bootstrap.min.css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css" />
        <link href="resources/css/style.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/chosen.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/compiled.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/jquery.toast.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/fontawesome.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/solid.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/brands.css" rel="stylesheet" type="text/css" />
    </head>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand"></a>
            <a href="https://yomedia.vn" title="Yomedia.vn" target="_blank">
                <img class="logo-yomedia" src="./resources/images/logo-yomedia.png" alt="" />
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </nav>
    </header>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-xl-8 offset-xl-2 pt-5 pb-2">
                    <h1>Ad Formats Demo Form</h1>
                    <p class="lead">Choose required options to generate an ad format demo link.</p>
                    <form id="frmCreateSource" name="create_source" method="get" action="#" role="form">
                        <div class="messages"></div>
                        <div class="controls">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group" id="type">
                                        <label for="optTypes">Ad View</label>
                                        <select id="optTypes" class="chosen-select form-control">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                    <div class="form-group" id="template">
                                        <label for="optTemplates">Template</label>
                                        <select class="chosen-select form-control" id="optTemplates">
                                            <option value="none">None</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="optAdformats">Ad Format</label>
                                        <select class="chosen-select form-control" id="optAdformats">
                                            <option value="none">None</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group" id="preview">
                                        <label for="preview">Template Preview</label>
                                        <div id="img-wrapper" class="img-wrapper">
                                           <img src="../resources/images/backgrounds/nocontent.jpg" value="none" title="No Preview Available" class="item-static-img" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" id="source">
                                    <div class="form-group">
                                        <label id="source_name">Source</label>
                                        <label id="video_tag_source_name">Video Tag Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain">
                                                <span class="input-group-text">
                                                    <i class="fas fa-link"></i>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" name="source" id="source_field" placeholder="source here ..."></input>
                                        </div>
                                    </div>
                                    <div class="form-group" id="addition_source">
                                        <label id="addition_source_name">Addition Source</label>
                                        <label id="video_source_name">Video Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <i class="fas fa-link"></i>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="addition_source_field" placeholder="source here ..."></input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="docs-pills border">
                                <div class="d-flex justify-content-between py-2" style="padding-left: .6rem;">
                                    <ul class="nav nav-pills">
                                        <li class="nav-item">
                                            <label class="nav-link active show">
                                                <i class="fas fa-external-link-alt"></i> Output Source
                                            </label>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-content" id="output">
                                    <div class="tab-pane fade active show" role="tabpanel">
                                        <div class="code-toolbar">
                                            <div class="toolbar">
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-sm" id="btnCopy" title="Copy to clipboard" data-clipboard-target="#output_source_field" style="right: 175px;"><i class="fas fa-copy"></i> Copy</button>
                                                </div>
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-sm" id="btnOpen" title="Open in new tab"><i class="fas fa-sign-out-alt"></i> Open in new tab</button>
                                                </div>
                                            </div>
                                            <textarea class="form-control" style="border-style: none" id="output_source_field" readonly></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hidden"><input type="submit"></div>
                    </form>
                </div>
                <div class="col-xl-8 offset-xl-2 pt-3 pb-5">
                    <a class="btn btn-primary" id="btnSave" title="Submit" style="color: #fff !important;" onclick="$('#frmCreateSource').submit();">
                        <i class="fas fa-paper-plane"></i> Submit
                    </a>
                    <a class="ml-2 btn btn-success" id="btnReset" title="Reset all inputs and options" style="color: #fff !important;">
                        <i class="fas fa-redo"></i> Reset
                    </a>
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="resources/js/jquery/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="resources/js/bootstrap/bootstrap.min.js"></script>
    <script type="text/javascript" src="resources/js/popper/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <script type="text/javascript" src="resources/js/chosen.jquery/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery/jquery.toast.js"></script>
    <script type="text/javascript" src="../resources/js/database.js"></script>
    <!-- Scripts  -->
    <script type="text/javascript">
    $("#addition_source").hide();
    $("#video_source_name").hide();
    $("#video_tag_source_name").hide();

    $(function () {
        $('#btnOpen').on('click', function () {
            event.preventDefault(); 
            openFunction();
        });
        $('#btnReset').on('click', function () {
            event.preventDefault(); 
            resetForm();
        });
        $("input[type='input']").click(function () {
            $(this).select();
        });
        $('#btnCopy').on('click', function() {
            event.preventDefault(); 
            var outputValue = $('#output_source_field').val();
            if( outputValue.length === 0) {
                $.toast({ heading:"Warning", text:"There is nothing to copy, please try again!", position:"top-right", showHideTransition:"fade", icon:"warning"});
            } else {
                var theButton = $(this);
                var clipboard = new ClipboardJS('#btnCopy');
                clipboard.on('success', function(e) {
                    $.toast({ heading: 'Success', text: 'Copied successfully!', position: 'top-right', showHideTransition: 'slide', icon: 'success' });
                    setTimeout(function() {
                    }, 2000);
                    clipboard.destroy();
                });
            }
        });
        
        //Ad views append
        $.each(list.devices, function (idx, obj) {
            $("#optTypes").append('<option type="' + obj.type + '" value="' + obj.value + '">' + obj.name + '</option>');
        });

        //Sort reverse function
        function sortArrays(val) {
            val.sort();
            val.reverse();
            console.log(val);
            return val;
        }

        //Ad view on change
        $("#optTypes").change(function(){
            var type = $(this).find(":selected").val();
            //Get filter Templates by Ad view
            var templates = list.templates.filter(function(template) {
                return template.type === type;
            });
            sortArrays(templates);
            //Get filter Adformats by Ad view
            var adformats = list.adformats.filter(function(adformat) {
                return adformat.type === type;
            });
            sortArrays(adformats);

            //Appends Templates by Type to Chosen Select Options
            $('#optTemplates').empty();
            $.each(templates, function (idx, obj) {
                $('#optTemplates').append(`<option type="${obj.type}" value="${obj.value}"">${obj.name}</option>`)            
            });
            //Appends Adformats by Type to Chosen Select Options
            $('#optAdformats').empty();
            $.each(adformats, function (idx, obj) {
                $('#optAdformats').append(`<option type="${obj.type}" value="${obj.value}">${obj.name}</option>`)            
            });

            //Get Templates current value
            selectedTemplate = $('#optTemplates').val();
            //Get Preview Image by Templates current value
            var templateImages = list.templates.filter(function(template) {
                return template.value === selectedTemplate;
            });
            $('#img-wrapper').empty();

            switch(type) {
                case 'display':
                    $("#source_name").show();
                    $("#addition_source, #video_tag_source_name").hide();
                    $("#source_field, #addition_source_field").val('');
                    //Append preview photo by type 'Display'
                    $.each(templateImages, function (idx, obj) {
                        $('#img-wrapper').append(`<img id="item-img" src="${obj.img}" class="item-img" />`)            
                    });
                    break;

                case 'mobile': 
                    $("#source_name").show();
                    $("#addition_source, #video_tag_source_name").hide();
                    $("#source_field, #addition_source_field").val('');
                    //Append preview photo by type 'Mobile'
                    $.each(templateImages, function (idx, obj) {
                        $('#img-wrapper').append(`<img id="item-img" src="${obj.img}" class="item-static-img" />`)            
                    });
                    break;

                case 'video':
                    $("#video_tag_source_name").show();
                    $("#addition_source, #source_name").hide();
                    $("#source_field, #addition_source_field").val('');
                    //Append preview photo by type 'Video'
                    $.each(templateImages, function (idx, obj) {
                        $('#img-wrapper').append(`<img id="item-img" src="${obj.img}" class="item-img" />`)            
                    });
                    break;
            }
            //Update new data to Chosen Select Options
            $('#optTemplates, #optAdformats').trigger('chosen:updated');
        });

        $("#optTemplates, #optAdformats, #optTypes").chosen({
            no_results_text: "Oops, nothing found!",
            placeholder_text_single: "Please select an option ...",
        });

        //Ad Format on change
        $("#optAdformats").change(function() {
            selectedType = $(this).val();
            switch (selectedType) {
                case 'billboard': case 'balloon': case '3d-post-carousel': 
                case 'masthead-mb': case 'inpage': case 'firstview': case 'bottom-up':
                case 'footer': case 'on-image-mb': case 'iab-medium-rectangle': 
                case 'iab-half-page': case 'in-native': case 'in-takeover': 
                    $("#source, #source_name").show();
                    $("#addition_source, #video_tag_source_name").hide();
                    $("#addition_source_field").val('');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                    break;
                
                case 'outstream': case 'instream':
                    $("#source, #video_tag_source_name").show();
                    $("#addition_source, #source_name").hide();
                    $("#addition_source_field").val('');   
                    break;
            }
        });

        $("#optTemplates").change(function() {
            var type = $('#optTypes').val();
            var selectedTemplate = $(this).val();    
            var templateImages = list.templates.filter(function(template) {
                return template.value === selectedTemplate;
            });        
            $('#img-wrapper').empty();
            switch(type) {
                case 'display': case 'video':
                    $.each(templateImages, function (idx, obj) {
                        $('#img-wrapper').append(`<img id="item-img" src="${obj.img}" class="item-img" />`)            
                    });
                    break;
                case 'mobile':
                    $.each(templateImages, function (idx, obj) {
                        $('#img-wrapper').append(`<img id="item-img" src="${obj.img}" class="item-static-img" />`)            
                    });
                    break;
            }
        });
    });

    //Reset Form
    function resetForm() {
        var selectedType = $('#optTypes').val();
        var selectedTemplate = $('#optTemplates').val();
        var selectedAdformat = $('#optAdformats').val();

        //If Type, Template or Adformat is empty
        if( selectedType.length === 0 || selectedTemplate.length === 0 || selectedAdformat.length === 0) {
                $.toast({ heading: 'Reset Failed!', text: 'Nothing to reset, please select all options!', position: 'top-right', showHideTransition: 'slide', icon: 'warning' });
        } else {
            $.toast({ heading: 'Reset successfully!', position: 'top-right', showHideTransition: 'slide', icon: 'success' });
            $('#frmCreateSource').trigger("reset");
            $('#optTypes, #optTemplates, #optAdformats').prop('selectedIndex',0);
            $('#optTemplates, #optAdformats, #output_source_field').empty();
            $('#optTemplates, #optAdformats, #optTypes, #preview').val('').trigger('chosen:updated');
            $('.chosen').trigger('chosen:updated');
            $("#addition_source, #video_source, #video_tag_source_name").hide();
            $("#source_name").show();
        }
    };

    //Open in new tab function
    function openFunction() {
        var outputValue = $('#output_source_field').val();
        if( outputValue.length === 0 ) {
            $.toast({ heading:"Warning", text:"There is nothing to open, please try again!", position:"top-right", showHideTransition:"fade", icon:"warning"});
        } else {
            window.open(outputValue);
        }
    };

    //Is valid URL function
    function isValidURL(str) {
        var regex = /(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;
        if(!regex .test(str)) {
            return false;
        } else {
            return true;
        }
    };

    //Submit
    $('#frmCreateSource').submit(function(e) {
        e.preventDefault();
        let adformatURL = '' ; 
        var selectedTemplate = $("#optTemplates").val();
        var selectedFormat = $("#optAdformats").val();
        var sourceURL = $("#source_field").val();
        var additionSourceURL = $("#addition_source_field").val();
        var url = window.location.href;
        var p = url.search("form/");
        if (p != -1) {
            url = url.substring(0, p);
        }
        //If Template, Adformat or Source is empty
        if(!selectedTemplate || !selectedFormat || !sourceURL) {
            $.toast({ heading:"Error", text:"Please choose an Ad View, Template or Ad Format before submitting!", position:"top-right", showHideTransition:"fade", icon:"error"});
            if(!sourceURL){
                $('#source_field').focus();
            }
            return;
        }
        adformatURL = `${url}site/${selectedTemplate}/index.html?f=${selectedFormat}&b=` + encodeURIComponent(`${sourceURL}`);
        additionSourceURL ? adformatURL = `${adformatURL}&c=` + encodeURIComponent(`${additionSourceURL}`) : adformatURL;

        $("#output_source_field").empty();
        $("#output_source_field").append(adformatURL);
        
        $.toast({heading:"Success",text:"Ad format demo link generated successfully!",position:"top-right",showHideTransition:"slide",icon:"success"});
    });
    </script>
</html>
