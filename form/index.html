<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>YOMEDIA | Ad Format Demo</title>
        <link rel="icon" href="favicon.ico" type="image/gif" sizes="16x16" />
        <link rel="stylesheet" href="resources/css/bootstrap.min.css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css" />
        <link href="resources/css/style.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/chosen.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/compiled.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/jquery.toast.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/fontawesome.min.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/solid.css" rel="stylesheet" type="text/css" />
        <link href="resources/css/brands.css" rel="stylesheet" type="text/css" />

    </head>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand"></a>
            <a href="https://yomedia.vn" target="_blank">
                <img class="logo-yomedia" src="./resources/images/logo-yomedia.png" alt="" />
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </nav>
    </header>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-xl-8 offset-xl-2 pt-5 pb-2">
                    <h1>Ad Formats Demo Form</h1>
                    <p class="lead">Fill in required fields to generate an ad format demo link.</p>
                    <form id="frmCreateSource" name="create_source" method="get" action="#" role="form">
                        <div class="messages"></div>
                        <div class="controls">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group" id="type">
                                        <label for="optTypes">Ad View</label>
                                        <select id="optTypes" class="chosen-select form-control">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group" id="template">
                                        <label for="optTemplates">Template</label>
                                        <select class="chosen-select form-control" id="optTemplates">
                                            <option value="">None</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="optAdformats">Ad Format</label>
                                        <select class="chosen-select form-control" id="optAdformats">
                                            <option value="">None</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" id="source">
                                    <div class="form-group">
                                        <label for="basic-url">Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain">
                                                <span class="input-group-text">
                                                    <i class="fas fa-link"></i>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" name="source" id="source_field" placeholder="source here ..."></input>
                                        </div>
                                    </div>
                                    <div class="form-group" id="addition_source">
                                        <label for="basic-url">Addition Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <i class="fas fa-link"></i>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="addition_source_field" placeholder="source here ..."></input>
                                        </div>
                                    </div>
                                    <div class="form-group" id="video_source">
                                        <label for="basic-url">Video Source</label>
                                        <div class="input-group mb-3">
                                            <div class="input-group-prepend" id="domain" style="height: 35px;">
                                                <span class="input-group-text">
                                                    <i class="fas fa-link"></i>
                                                </span>
                                            </div>
                                            <input class="form-control" type="input" id="video_source_field" placeholder="source here ..."></input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="docs-pills border">
                                <div class="d-flex justify-content-between py-2" style="padding-left: .6rem;">
                                    <ul class="nav nav-pills">
                                        <li class="nav-item">
                                            <label class="nav-link active show">
                                                <i class="fas fa-external-link-alt"></i> Output Source
                                            </label>
                                        </li>
                                  </ul>
                                </div>
                                <div class="tab-content" id="output">
                                    <div class="tab-pane fade active show" role="tabpanel">
                                        <div class="code-toolbar">
                                            <div class="toolbar">
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-success btn-sm " id="btnCopy" data-clipboard-target="#output_source_field" style="right: 175px;"><i class="fas fa-copy"></i> Copy</button>
                                                </div>
                                                <div class="toolbar-item">
                                                    <button class="btn-copy-code btn btn-dark btn-sm" id="btnOpen"><i class="fas fa-sign-out-alt"></i> Open in Browser</button>
                                                </div>
                                            </div>
                                            <textarea class="form-control" style="border-style: none" id="output_source_field" readonly></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hidden"><input type="submit"></div>
                    </form>
                </div>
                    <div class="col-xl-8 offset-xl-2 pt-3">
                        <a class="btn btn-success btn-send" id="btnSave" style="color: #fff !important;" onclick="$('#frmCreateSource').submit();">
                            <i class="fas fa-paper-plane"></i> Submit
                        </a>
                        <a class="ml-2 btn btn-warning btn-send" id="btnReset" style="color: #fff !important;">
                            <i class="fas fa-redo"></i> Reset
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="resources/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="resources/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="resources/js/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
    <script type="text/javascript" src="resources/js/chosen.jquery.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery.toast.js"></script>
    <script type="text/javascript" src="scripts/database.js"></script>
    <!-- Scripts  -->
    <script type="text/javascript">
    $("#addition_source").hide();
    $("#video_source").hide();

    $(function () {
        //Buttons area
        $('#btnOpen').on('click', function () {
            event.preventDefault(); 
            openFunction();
        });
        $('#btnReset').on('click', function () {
            event.preventDefault(); 
            resetForm();
        });
        $("input[type='input']").click(function () {
            $(this).select();
        });
        $('#btnCopy').on('click', function() {
            event.preventDefault(); 
            var outputValue = $('#output_source_field').val();
            if( outputValue.length === 0) {
                $.toast({ heading:"Warning", text:"There is nothing to copy, please try again!", position:"top-right", showHideTransition:"fade", icon:"warning"});
            } else {
                var theButton = $(this);
                var clipboard = new ClipboardJS('#btnCopy');
                clipboard.on('success', function(e) {
                    $.toast({ heading: 'Success', text: 'Copied successfully!', position: 'top-right', showHideTransition: 'slide', icon: 'success' });
                    setTimeout(function() {
                    }, 2000);
                    clipboard.destroy();
                });
            }
        });
        
        //Show Device select option
        $.each(list.devices, function (idx, obj) {
            $("#optTypes").append('<option type="' + obj.type + '" value="' + obj.value + '">' + obj.name + '</option>');
        });

        $("#optTemplates, #optAdformats, #optTypes").chosen({
            no_results_text: "Oops, nothing found!",
            placeholder_text_single: "Please select an option ...",
        });
        
        //Type Device on change
        $("#optTypes").change(function(){
            var type = $(this).find(":selected").val();
            var templates = list.templates.filter(function(template) {
                return template.type === type;
            });
            var adformats = list.adformats.filter(function(adformat) {
                return adformat.type === type;
            });

            $('#optTemplates').empty();
            $.each(templates, function (idx, obj) {
                $('#optTemplates').append(`<option type="${obj.type}" value="${obj.value}">${obj.name}</option>`)            
            });
            $("#optTemplates").html($("#optTemplates option").sort(function (a, b) {
                return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
            }));

            $('#optAdformats').empty();
            $.each(adformats, function (idx, obj) {
                $('#optAdformats').append(`<option type="${obj.type}" value="${obj.value}">${obj.name}</option>`)            
            });
            $("#optAdformats").html($("#optAdformats option").sort(function (a, b) {
                return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
            }));
            $('#optTemplates, #optAdformats').trigger('chosen:updated');
        });

        //Ad Format on change
        $("#optAdformats").change(function() {
        selectedType = $(this).val();
            switch (selectedType) {
                case 'billboard': case 'balloon': case '3d-post-carousel': 
                case 'masthead-mb': case 'inpage': case 'firstview': 
                case 'footer': case 'on-image-mb': case 'iab-medium-rectangle': 
                case 'iab-half-page': case 'outstream': case 'instream':
                    $("#source").show();
                    $("#addition_source").hide();
                    $("#video_source").hide();
                    $("#addition_source_field").val('');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                    $("#video_source_field").val('');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                    break;
        
                case 'in-native': case 'in-takeover': case 'in-carousel': case 'on-image-pc':
                    $("#source").show();
                    $("#addition_source").show();
                    $("#video_source").hide();
                    $("#video_source_field").val('');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                    break;

                case 'in-inread':
                    $("#source").show();
                    $("#video_source").show();
                    $("#addition_source").hide();
                    $("#addition_source_field").val('');
                    break;
            }
        });
    });

    //Reset Form
    function resetForm() {
        var selectedType = $('#optTypes').val();
        var selectedTemplate = $('#optTemplates').val();
        var selectedAdformat = $('#optAdformats').val();

        if( selectedType.length === 0 || selectedTemplate.length === 0 || selectedAdformat.length === 0) {
                $.toast({ heading: 'Warning', text: 'Nothing to reset, please select all options!', position: 'top-right', showHideTransition: 'slide', icon: 'warning' });
        } else {
            $.toast({ heading: 'Success', text: 'Reset successfully!', position: 'top-right', showHideTransition: 'slide', icon: 'success' });
            $('#frmCreateSource').trigger("reset");
            $('#optTypes, #optTemplates, #optAdformats').prop('selectedIndex',0);
            $('#optTemplates, #optAdformats').empty();
            $('#optTemplates, #optAdformats, #optTypes').val('').trigger('chosen:updated');
            $('.chosen').trigger('chosen:updated');
            $("#addition_source").hide();
            $("#video_source").hide();
            $('#output_source_field').empty();
        }
    };

    //Open function for btnOpen
    function openFunction() {
        var outputValue = $('#output_source_field').val();
        if( outputValue.length === 0 ) {
            $.toast({ heading:"Warning", text:"There is nothing to open, please try again!", position:"top-right", showHideTransition:"fade", icon:"warning"});
        } else {
            window.open(outputValue);
        }
    };

    //Is valid URL
    function isValidURL(str) {
        var regex = /(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;
        if(!regex .test(str)) {
            return false;
        } else {
            return true;
        }
    };

    //Submit
    $('#frmCreateSource').submit(function(e) {
        e.preventDefault();
        let adformatURL = '' ; 
        var selectedTemplate = $("#optTemplates").val();
        var selectedFormat = $("#optAdformats").val();
        var sourceURL = $("#source_field").val();
        var additionSourceURL = $("#addition_source_field").val();
        var video_sourceURL = $("#video_source_field").val();
        var url = window.location.href;
        var prefix = "https://demo.yomedia.vn"
        var p = url.search("form/");
        if (p != -1) {
            url = url.substring(0, p);
        }
        if(!selectedTemplate || !selectedFormat || !sourceURL) {
            $.toast({ heading:"Error", text:"Please choose an Ad View, Template or Ad Format before submitting!", position:"top-right", showHideTransition:"fade", icon:"error"});
            if(!sourceURL){
                $('#source_field').focus();
            }
            return;
        }
        if(isValidURL(sourceURL || additionSourceURL || video_sourceURL)) {
            adformatURL = `${url}sites/${selectedTemplate}/index.html?f=${selectedFormat}&b=${sourceURL}`;
            additionSourceURL ? adformatURL = `${adformatURL}&c=${additionSourceURL}` : adformatURL;
            video_sourceURL ? adformatURL = adformatURL + '&c=' + `${video_sourceURL}` : adformatURL;
        } else {
            adformatURL = `${url}sites/${selectedTemplate}/index.html?f=${selectedFormat}&b=${prefix}/${sourceURL}`;
            additionSourceURL ? adformatURL = `${adformatURL}&c=${prefix}/${additionSourceURL}` : adformatURL;
            video_sourceURL ? adformatURL = `${adformatURL}&c=${prefix}/${video_sourceURL}` : adformatURL;
        }
        $("#output_source_field").empty();
        $("#output_source_field").append(adformatURL);
        
        $.toast({heading:"Success",text:"Ad format demo link generated successfully!",position:"top-right",showHideTransition:"slide",icon:"success"});
    });
    </script>
</html>
